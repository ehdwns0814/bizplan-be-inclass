---
description: Guidelines for RESTful API design, naming conventions, error handling, and response formatting in Spring Boot.
globs: src/main/java/**/*Controller.java, src/main/java/**/*Dto.java, src/main/java/**/*Exception.java
alwaysApply: true
---
# REST API Design & Error Handling Rules

## 1. URI Naming Conventions
- **Kebab-case**: Use lowercase letters and hyphens for URIs (e.g., `/api/v1/user-profiles`).
- **Plural Nouns**: Use plural nouns for resources (e.g., `/users`, not `/user`).
- **Hierarchy**: Use nesting for related resources (e.g., `/users/{id}/orders`).
- **Versioning**: Always include versioning in the path (e.g., `/api/v1/...`).

## 2. HTTP Methods & Status Codes
Use standard HTTP methods and status codes to represent the action and result.

| Method | Action | Success Status | Error Status (Common) |
| :--- | :--- | :--- | :--- |
| **GET** | Retrieve resource(s) | `200 OK` | `404 Not Found` |
| **POST** | Create a resource | `201 Created` | `400 Bad Request`, `422 Unprocessable Entity` |
| **PUT** | Update/Replace resource | `200 OK` | `404 Not Found`, `400 Bad Request` |
| **PATCH** | Partial update | `200 OK` | `404 Not Found`, `400 Bad Request` |
| **DELETE** | Delete a resource | `204 No Content` | `404 Not Found` |

## 3. Response Format (Envelope Pattern)
All API responses must follow a consistent structure.

```json
{
  "result": "SUCCESS", // or "ERROR"
  "data": { ... },     // Payload (null if error)
  "message": "...",    // Optional human-readable message
  "errorCode": "..."   // Optional application-specific error code (if error)
}
```

### 3.1 Implementation Guide
- Create a generic `ApiResponse<T>` class.
- Controllers should return `ApiResponse<Dto>`.
- `204 No Content` should not have a body.

## 4. Error Handling
- **Global Handler**: Use `@RestControllerAdvice` to handle exceptions globally.
- **Custom Exceptions**: Create a base `BusinessException` extending `RuntimeException`.
- **Validation Errors**: Handle `MethodArgumentNotValidException` to return field-level error details.

### 4.1 Error Response Structure
```json
{
  "result": "ERROR",
  "data": null,
  "message": "Invalid input",
  "errorCode": "INVALID_INPUT",
  "errors": [ // Optional: For validation errors
    { "field": "email", "reason": "Must be a valid email" }
  ]
}
```

## 5. Documentation
- **OpenAPI / Swagger**: Annotate controllers and DTOs with `@Operation`, `@Schema`, etc.
- **Descriptions**: Provide clear descriptions for endpoints, parameters, and response fields.
